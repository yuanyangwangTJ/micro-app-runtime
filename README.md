# micro-app-runtime

实现一个简易小程序运行时，可以在浏览器中运行简易的代码。

## 实现原理

### 双线程结构

小程序底层采用双线程模型结构，通过web-worker搭建简易的双线程模型，实现小程序**视图层**与**逻辑层**的通信。

### 小程序DSL编译

考虑到react与小程序在语法上有很大的相似性，参考这篇[文章](https://juejin.cn/post/6844903624938635272#heading-4)，所以小程序DSL语言的编译建立在**babel**对react的编译之上，这样可以简易对DSL的解析。

### 渲染框架

实现简单的基于vdom的小程序渲染，实现对于jsx的编译与渲染，主要参考文章：[手写前端框架代码](https://github.com/QuarkGluonPlasma/frontend-framework-exercize)，采用其中的`patch`版本。

### 自定义组件

小程序的部分组件需要自定义实现，比如`view`，借助于react的`Component`概念，进行扩展实现，示例代码中也实现了自定义组件`List`，表明了对于小程序自定义组件的支持。

## 运行

### 环境安装

```bash
# 进入根目录
npm install
```

### 编译并启动

```bash
npm run dev
```

打开浏览器，可以在<http://localhost:3000>查看小程序的渲染结果。

> 小程序的代码在`pages`目录下，可以进行修改，保存后需要重新编译运行

## 支持的小程序DSL

本项目所实现的小程序运行时比较简陋，小程序本身的代码放置在`pages`目录下，并未完全按照目前市场主流小程序使用`xxml`和`xxss`的样式，目前将`data`和`jsx`放置在同一文件中，只是实现了简单的DSL语言，对于真正的小程序还有亿步之遥。
